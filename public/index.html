<!DOCTYPE html>
<html>
<head>
    <title>Sensei</title>
    <style>
        #jsonResponse {
            white-space: pre-wrap;       /* Since JSON is formatted with white space */
            word-wrap: break-word;       /* To prevent horizontal scrolling */
            background-color: #f4f4f4;   /* Light grey background */
            border: 1px solid #ddd;      /* Adding a border */
            padding: 10px;               /* Some padding for aesthetics */
            font-family: 'Courier New', monospace; /* Font change to monospace */
        }
    </style>
</head>
<body>
    <form id="chatForm">
        <label for="prompt">Enter your prompt:</label>
        <br>
        <textarea id="prompt" name="prompt" rows="10" cols="200"></textarea>
        <br>
        <button type="submit">Send</button>
    </form>
    <pre id="jsonResponse"></div>

    <script>
        document.getElementById('chatForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const prompt = document.getElementById('prompt').value;
            fetch('/prompt', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ prompt }),
            })
            .then(response => response.json())
            .then(data => {
                console.log("Request initiated", data);
                // Start polling for the result using the requestId
                if (data.requestId) {
                    pollStatus(data.requestId);
                }
            })
            .catch(error => console.error('Error:', error));
        });

        function pollStatus(requestId) {
            console.log('Polling for status with requestId:', requestId);
            const intervalId = setInterval(() => {
                fetch(`/status/${requestId}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log('Polling response:', data);
                        if (data.status === 'completed' || data.status === 'failed') {
                            clearInterval(intervalId); // Stop polling
                            document.getElementById('jsonResponse').textContent = JSON.stringify(data, null, 2);
                        }
                    })
                    .catch(error => {
                        console.error('Polling error:', error);
                        clearInterval(intervalId); // Consider stopping polling on error
                    });
            }, 2000); // Poll every 2 seconds
        }
    </script>
</body>
</html>
